<!DOCTYPE html>
<html>
<head>
    <title>Registrar Descarga</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container my-5 text-center">
        <h4 id="mensaje">Procesando descarga...</h4>
    </div>

    <!-- Scripts -->
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const idPrograma = urlParams.get("idPrograma");
            const nombre = decodeURIComponent(urlParams.get("nombre"));
            const estado = "completa";

            try {
                // Enviar datos al servidor para registrar la descarga
                const respuesta = await fetch("https://localhost:7166/api/Descarga", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        idPrograma: parseInt(idPrograma),
                        nombre: nombre,
                        estado: estado
                    })
                });

                if (!respuesta.ok) {
                    throw new Error(`Error ${respuesta.status}: ${respuesta.statusText}`);
                }

                // Mostrar mensaje de éxito y redirigir al usuario
                document.getElementById("mensaje").textContent = "Descarga registrada exitosamente. Redirigiendo...";
                setTimeout(() => {
                    window.location.href = "Explorar.html";
                }, 2000);
            } catch (error) {
                console.error("Error al registrar la descarga:", error);
                document.getElementById("mensaje").textContent = "Hubo un error al registrar la descarga. Intenta nuevamente.";
            }
        });
    </script>
</body>
</html>
